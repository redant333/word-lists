(()=>{"use strict";function t(t,e){let s=t[e];return void 0!==s?s:t}class e{constructor(t,e){this._words=t,this._lastWordIndex=null,this._excludedGivenWords=e||[]}_randomInt(t){return Math.floor(Math.random()*t)}_getRandomWord(){let t=null;for(;t===this._lastWordIndex||null===t;)t=this._randomInt(this._words.length);this._lastWordIndex=t;let e=null;for(;null===e||"-"===this._words[t][0][e];)e=this._randomInt(this._words[t][0].length);let s=null;for(;s===e||null===s;)s=this._randomInt(this._words[t][0].length);let n=null;return this._words[t][0][e]instanceof Array&&(n=this._randomInt(this._words[t][0][e].length)),[t,n,e,s]}nextWord(){let e=null,s=null;do{e=this._getRandomWord();const[n,i,o]=e;s=t(this._words[n][0][o],i)}while(this._excludedGivenWords.includes(s));return e}}const s="STATE_GUESSING",n="STATE_SUCCESS",i="STATE_FAILURE";class o{constructor(t,s,n,i,o){this._wordRandomizer=o||new e(t,i),this._words=t,this._forms=s,this._infos=n,this._successCount=0,this._failureCount=0,this._state=null}get state(){return this._state}get wantedWords(){return this._wantedWords}get wantedWordAllInfos(){return this._wantedWordAllInfos}get wantedWordAllForms(){return this._wantedWordAllForms}get givenWord(){return this._givenWord}get givenForm(){return this._givenForm}get wantedForm(){return this._wantedForm}get successCount(){return this._successCount}get failureCount(){return this._failureCount}start(){const[e,n,i,o]=this._wordRandomizer.nextWord();this._wantedWords=[this._words[e][0][o]].flat(),this._wantedWordAllForms=[];for(let t=0;t<this._forms.length;t++)this._wantedWordAllForms.push([this._forms[t],[this._words[e][0][t]].flat()]);this._wantedWordAllInfos=[];for(let t=0;t<this._infos.length;t++)this._wantedWordAllInfos.push([this._infos[t],this._words[e][1][t]]);this._givenWord=t(this._words[e][0][i],n),this._wantedForm=this._forms[o],this._givenForm=this._forms[i],this._state=s}guess(t){this._wantedWords.map((t=>t.toLowerCase())).includes(t.toLowerCase())?(this._state=n,this._successCount++):(this._state=i,this._failureCount++)}}class r{constructor(t){this.dataFile="/word-lists/data/"+t}setControls(){function t(t){return document.getElementById(t)}this.sGivenWord=t("id_word"),this.sWantedWord=t("id_expected_word"),this.sGivenForm=t("id_given_form"),this.sWantedForm=t("id_wanted_form"),this.sWantedFormFailure=t("id_wanted_form_failure"),this.bCheck=t("id_check"),this.bNext=t("id_next"),this.iInput=t("id_input"),this.dSuccess=t("id_success"),this.dFailure=t("id_failure"),this.sSuccessCount=t("id_success_count"),this.sFailureCount=t("id_failure_count"),this.dAllForms=t("id_all_forms"),this.dAllInfos=t("id_all_infos")}start(){fetch(this.dataFile).then((t=>t.json())).then((t=>{this.stateMachine=new o(t.list,t.metadata.forms,t.metadata.infos,t.metadata.excludedGivenWords),this.stateMachine.start(),this.setControls(),this.setEventListeners(),this.adaptControlsToState()}))}setEventListeners(){this.bCheck.addEventListener("click",(()=>{this.handleInput()})),this.iInput.addEventListener("keyup",(t=>{"Enter"===t.key&&this.stateMachine.state===s&&this.bCheck.click()})),this.bNext.addEventListener("click",(()=>{this.stateMachine.start(),this.adaptControlsToState()}))}handleInput(){const t=this.iInput.value.trim();""!==t?(this.stateMachine.guess(t),this.adaptControlsToState()):this.iInput.focus()}_createReferenceTableRow(t,e){const s=document.getElementById("id_reference_table_row").content.cloneNode(!0);return s.querySelector(".data-name").innerText=t,s.querySelector(".data-value").innerText=e,s}adaptControlsToState(){if(this.stateMachine.state===s)return this.bNext.setAttribute("hidden",!0),this.bCheck.removeAttribute("hidden"),this.iInput.value="",this.iInput.removeAttribute("readonly"),this.iInput.placeholder=this.stateMachine.wantedForm,this.dFailure.setAttribute("hidden",!0),this.dSuccess.setAttribute("hidden",!0),this.sGivenForm.innerText=this.stateMachine.givenForm,this.sGivenWord.innerText=this.stateMachine.givenWord,this.sWantedForm.innerText=this.stateMachine.wantedForm,this.dAllForms.setAttribute("hidden",!0),this.dAllInfos.setAttribute("hidden",!0),void this.iInput.focus();if(this.stateMachine.state===n||this.stateMachine.state===i){this.bNext.removeAttribute("hidden"),this.bCheck.setAttribute("hidden",!0),this.iInput.setAttribute("readonly",!0),this.sSuccessCount.innerText=this.stateMachine.successCount,this.sFailureCount.innerText=this.stateMachine.failureCount,this.dAllInfos.innerHTML="";for(const[t,e]of this.stateMachine.wantedWordAllInfos)this.dAllInfos.appendChild(this._createReferenceTableRow(t,e));this.dAllInfos.removeAttribute("hidden"),this.dAllForms.innerHTML="";for(const[t,e]of this.stateMachine._wantedWordAllForms)this.dAllForms.appendChild(this._createReferenceTableRow(t,e));this.dAllForms.removeAttribute("hidden"),this.bNext.focus()}this.stateMachine.state===n?this.dSuccess.removeAttribute("hidden"):this.stateMachine.state===i&&(this.sWantedFormFailure.innerText=this.stateMachine.wantedForm,this.sWantedWord.innerText=this.stateMachine.wantedWords,this.dFailure.removeAttribute("hidden"))}}function d(t){return`id_group_${t.title.replace(/\W/g,"").toLowerCase()}`}function a(t,e,s){const n=document.getElementById("id_word_list_entry").content.cloneNode(!0);return n.querySelector(".data-title").innerText=t,n.querySelector(".data-description").innerHTML=e,n.querySelectorAll(".data-link").forEach((t=>{t.href+=s})),n}function h(t){const e=document.createElement("div");e.classList+="mt-4";const s=function(t,e){const s=document.createElement("h4");return s.innerText=e,s}(0,t.title);s.id=d(t),e.appendChild(s);for(const s of t.lists){const t=a(s.title,s.description,s.listName);e.appendChild(t)}return e}function l(t){const e=document.getElementById("id_toc_entry_template").content.cloneNode(!0),s=e.querySelector(".data-link");return s.href=`#${d(t)}`,s.innerText=t.title,e.querySelector(".data-count").innerText=t.lists.length,e}function c(){return window.location.search.substring(1)}window.WordListsLoader={loadPractice:function(){new r(c()).start()},loadIndex:function(t,e){fetch("/word-lists/data/index.json").then((t=>t.json())).then((s=>{!function(t,e){for(const s of e)t.appendChild(h(s))}(document.getElementById(t),s),function(t,e){for(const s of e)t.appendChild(l(s))}(document.getElementById(e),s)}))},loadList:function(t){var e,s;e=t,s="/word-lists/data/"+(s=c()),fetch(s).then((t=>t.json())).then((t=>{!function(t,e){const s=document.getElementById(t);!function(t,e){const s=document.createElement("thead");t.appendChild(s);const n=document.createElement("tr");s.appendChild(n);for(const t of e){const e=document.createElement("th");e.setAttribute("scope","col"),e.innerText=t,n.appendChild(e)}}(s,[...e.metadata.forms,...e.metadata.infos]);const n=document.createElement("tbody");s.appendChild(n);for(const t of e.list){const e=document.createElement("tr");n.appendChild(e);for(let s of t.flat()){const t=document.createElement("td");t.innerText=s,e.appendChild(t)}}}(e,t)}))}}})();